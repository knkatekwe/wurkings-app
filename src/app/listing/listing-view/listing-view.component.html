<div class="container">

  <div class="row py-2">
    <!-- <div class="d-flex justify-content-between">
      <a>
        <i class="fa fa-map-marker pl-3" aria-hidden="true"></i>
      </a>
      <a>
        <small class="text-muted pl-1">{{selectedListing.city}}, {{selectedListing.state}}</small>
      </a>
    </div> -->

  </div>

  <div class="row">

    <div class="col-md-6">

      <ngb-carousel *ngIf="selectedListing.listing_images">
        <ng-template ngbSlide *ngFor="let picture of selectedListing.listing_images">
          <div class="picsum-img-wrapper">
            <img [src]="picture.image_url" [alt]="picture.alt" height="250px;" class="img-fluid mx-auto d-block">
          </div>
        </ng-template>
      </ngb-carousel>
      <!--class="img-fluid w-75 h-75 mx-auto d-block"-->

    </div>

    <div class="col-md-6">

      <div class="pt-6"></div>

      <div class="d-flex justify-content-between">
        <a [routerLink]="['.']">
          <small class="text-muted">{{(category$|async)?.category_title}}</small>
        </a>
        <div>
          <a [routerLink]="['.']" class="pr-2"><small class="pr-1">Save</small><i class="fa fa-heart-o fa"></i></a>
          <a [routerLink]="['.']"><small class="pr-1">Share</small><i class="fa fa-share-alt-square"></i></a>
        </div>
      </div>

      <h3>{{selectedListing.title}}<span class="badge badge-secondary">New</span></h3>

      <p>{{selectedListing.description}}</p>

      <!-- <h5 class="pt-4 pb-2">
        Conditions/Rules
      </h5> -->

      <!-- <span *ngIf="selectedListing.allCan"><p><i class="fa fa-check-circle pr-1" aria-hidden="true"></i>Anyone can rent</p></span>
      <span *ngIf="selectedListing.onlyStudent"><p><i class="fa fa-check-circle pr-1" aria-hidden="true"></i>Student Can Rent</p></span>
      <span *ngIf="selectedListing.onlyWorking"><p><i class="fa fa-check-circle pr-1" aria-hidden="true"></i>Working Class</p></span> -->

      <!-- <div class="border-bottom"></div> -->

      <div class="d-flex justify-content-between pt-3">

        <p><strong>Belongs to:</strong> {{userProfile?.username}}</p>

        <a [routerLink]="['/profile', selectedListing?.user_id]">
          <img [src]="userProfile?.profile_picture_url" width="30"
            height="30" class="rounded-circle border">
        </a>
      </div>

      <!-- <div class="border-bottom"></div> -->

      <div class="pt-6"></div>

      <div class="card py-4 offset-md-1" style="width: 25rem;">
        <div class="card-body">

          <div class="d-flex justify-content-between">
            <div>
              <span>
                <select (change)="setPrice(paymentRateId.value)" [formControl]="paymentRateId"
                  class="custom-select mr-sm-2" class="form-control-sm">
                  <option *ngFor="let paymentRate of selectedListing?.payment_rates" [value]="paymentRate.id" selected>
                    {{paymentRate.title}},
                    {{paymentRate.price | currency}}</option>
                </select>
              </span>
            </div>
            <div>
              <a class="pr-2"><i class="fa fa-star-o pr-1"><small class="pr-1 text-muted">5.0(8)</small></i></a>
            </div>
          </div>

          <form [formGroup]="form">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <small id="helpId" class="form-text text-muted"><strong>Start date: </strong>
                    {{f.start_date.value | date}} </small>
                  <!-- <input class="form-control" placeholder="dd/mm/yyyy" name="d2" #c2="ngModel" [(ngModel)]="period"
                    (click)="d2.toggle()" ngbDatepicker #d2="ngbDatepicker"> -->
                  <input class="form-control" (change)='changeDate()' type="date" formControlName="start_date"
                    [ngClass]="{'border-danger':f.start_date.invalid, 'border-success': f.start_date.valid}">
                  <div *ngIf="f.start_date.invalid && f.start_date.touched" class="invalid-control">
                    Date is required.
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <small id="quantity" class="form-text text-muted"><strong>Duration</strong></small>
                  <input type="text" (change)="changeDuration()"
                    onkeypress="return (event.charCode == 8 || event.charCode == 0 || event.charCode == 13) ? null : event.charCode >= 48 && event.charCode <= 57"
                    class="form-control" formControlName="quantity"
                    [ngClass]="{'border-danger':f.quantity.invalid, 'border-success': f.quantity.valid}">
                  <div *ngIf="f.quantity.invalid && f.quantity.touched" class="invalid-control">
                    Duration is required.
                  </div>
                  <!-- <select class="custom-select mr-sm-2" formControlName="quantity">
                    <option selected>Choose...</option>
                    <option [value]="digit.number" *ngFor="let digit of digits">{{digit.number}}</option>
                  </select> -->
                </div>
              </div>
              <!-- <input type="hidden" formControlName="total_amount" [ngModel]="totalAmount" /> -->
              <input type="hidden" formControlName="service_fee" [ngModel]="serviceFee" />
              <input type="hidden" formControlName="total" [ngModel]="totalForRental" />
              <!-- <input type="hidden" formControlName="status" /> -->
            </div>
            <button type="button" class="btn btn-primary btn btn-block" (click)="onSubmit()"
              [hidden]="currentUser.id ===selectedListing.user_id" [disabled]="!form.valid">Reserve</button>
          </form>
          <div *ngIf="f.total.value > 0">
            <p class="text-sm text-center mt-2">You won't be charged just yet</p>
            <div class="d-flex justify-content-between">
              <P>{{rate.value | currency: 'USD': 'symbol-narrow'}} x {{f.quantity.value}} <span
                  *ngIf="paymentRateTitle ==='hourly'">hour(s)</span>
                <span *ngIf="paymentRateTitle ==='daily'">day(s)</span>
                <span *ngIf="paymentRateTitle ==='weekly'">week(s)</span>
                <span *ngIf="paymentRateTitle ==='monthly'">month(s)</span>
              </P>
              <P>{{f.price.value * f.quantity.value | currency: 'USD': 'symbol-narrow'}}</P>
            </div>
            <div class="d-flex justify-content-between">
              <P>Service Fee</P>
              <P>{{f.service_fee.value | currency: 'USD': 'symbol-narrow'}}</P>
            </div>
            <div class="border-bottom mb-2"></div>
            <div class="d-flex justify-content-between">
              <P>Total</P>
              <P>{{f.total.value | currency: 'USD': 'symbol-narrow'}}</P>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">

    <div class="col-md-12">

      <h5 class="pt-4 pb-2">
        Reviews
      </h5>

      <div class="row">
        <div class="col-md-6">
          <app-review-preview></app-review-preview>
        </div>
        <div class="col-md-6">
          <app-review-preview></app-review-preview>
        </div>
      </div>

    </div>

    <!-- <div class="col-md-6 sticky">

      <div class="pt-6"></div>

      <div class="card py-4 offset-md-1" style="width: 25rem;">
        <div class="card-body">

          <div class="d-flex justify-content-between">
            <div>
              <span>
                <h5 class="card-title">
                  {{selectedListing?.payment_rates[0]?.price | currency: 'USD': 'symbol-narrow'}}/day</h5>
              </span>
            </div>
            <div>
              <a class="pr-2"><i class="fa fa-star-o pr-1"><small class="pr-1 text-muted">5.0(8)</small></i></a>
            </div>
          </div>

          <form [formGroup]="form">

            <div class="row">
              <div class="col">
                <div class="form-group">

                  <input type="hidden" formControlName="user" [ngModel]="currentUser.id" />
                  <input type="hidden" formControlName="listing" [ngModel]="selectedListing.id" />

                  <small id="helpId" class="form-text text-muted">From</small>
                  <input type="date" class="form-control" formControlName="start_date" [(ngModel)]="startDate"
                    (change)="calculate(startDate, endDate)" aria-describedby="helpId">
                </div>
              </div>
              <div class="col">
                <div class="form-group">
                  <small id="helpId" class="form-text text-muted">To</small>
                  <input type="date" class="form-control" formControlName="end_date" [(ngModel)]="endDate"
                    (change)="calculate(startDate, endDate)" aria-describedby="helpId">
                </div>
              </div>

              <input type="hidden" formControlName="total_amount" [ngModel]="totalAmount" />

              <input type="hidden" formControlName="service_fee" [ngModel]="serviceFee" />
              <input type="hidden" formControlName="total_for_rental" [ngModel]="totalForRental" />

              <input type="hidden" formControlName="status" />

            </div>

            <button type="button" class="btn btn-primary btn btn-block" (click)="onSubmit()" [hidden]="canModify"
              [disabled]="!form.valid">Reserve</button>

          </form>

          <div [hidden]="show">
            <p class="text-sm text-center mt-2">You won't be charged just yet</p>
            <div class="d-flex justify-content-between">
              <P>{{selectedListing?.payment_rates[0]?.price | currency: 'USD': 'symbol-narrow'}} x {{numberOfDays}} days
              </P>
              <P>{{totalForRental | number : '1.2-2' | currency: 'USD': 'symbol-narrow'}}</P>
            </div>
            <div class="d-flex justify-content-between">
              <P>Service Fee</P>
              <P>{{serviceFee | number : '1.2-2' | currency: 'USD': 'symbol-narrow'}}</P>
            </div>
            <div class="border-bottom mb-2"></div>
            <div class="d-flex justify-content-between">
              <P>Total</P>
              <P>{{totalAmount | number : '1.2-2' | currency: 'USD': 'symbol-narrow'}}</P>
            </div>
          </div>

        </div>
      </div>

    </div> -->

    <div class="row">

      <div class="col-md-6">



      </div>

    </div>

  </div>
  <!-- <pre>{{form.value | json}}</pre> -->
